<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cabo Frio Trip 2025</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Firebase (Opcional - L√≥gica Local Implementada) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root {
            --blue: #007AFF;
            --orange: #FF9500;
            --green: #34C759;
            --purple: #AF52DE;
            --teal: #5AC8FA;
            --red: #FF3B30;
            --yellow: #FFCC00;
            --gray: #8E8E93;

            --bg-app: #F2F2F7;
            --bg-card: #FFFFFF;
            --text-primary: #1C1C1E;
            --text-secondary: #636366;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-app);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* LAYOUT */
        #layout-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            position: relative;
            /* Added for absolute positioning of toggle btn */
        }

        /* MAP TOGGLE */
        .map-toggle-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            font-weight: 600;
            font-size: 0.8rem;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        #map-area.collapsed {
            height: 0 !important;
            flex: 0 0 0;
            overflow: hidden;
        }

        #map-area {
            height: 35vh;
            width: 100%;
            background: #e5e5e5;
            z-index: 10;
            position: relative;
            transition: height 0.3s ease;
        }

        #content-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 110px;
            scroll-behavior: smooth;
            background: var(--bg-app);
        }

        @media (min-width: 1024px) {
            #layout-container {
                flex-direction: row-reverse;
            }

            #map-area {
                height: 100vh;
                width: 55%;
            }

            #content-area {
                height: 100vh;
                width: 45%;
                padding: 40px;
            }

            .dock {
                width: 50% !important;
                left: 25% !important;
                max-width: 600px;
            }
        }

        /* HEADER & DATE SELECTOR */
        .app-header {
            margin-bottom: 25px;
        }

        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0 0 15px 0;
            letter-spacing: -0.5px;
            color: #000;
        }

        .days-scroller {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 5px;
            scrollbar-width: none;
        }

        .day-btn {
            background: var(--bg-card);
            border: 1px solid rgba(0, 0, 0, 0.05);
            padding: 10px 16px;
            border-radius: 20px;
            white-space: nowrap;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            font-size: 0.9rem;
        }

        .day-btn.active {
            background: var(--blue);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.4);
            transform: scale(1.05);
        }

        /* CARDS */
        .summary-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
        }

        .checklist {
            background: #F0F8FF;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid var(--blue);
        }

        .event-card {
            background: var(--bg-card);
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.04);
            border-left: 5px solid transparent;
        }

        .event-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 12px;
        }

        .event-emoji {
            font-size: 2.2rem;
            background: #F2F2F7;
            width: 55px;
            height: 55px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .event-time-badge {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-primary);
            background: #E5E5EA;
            padding: 4px 10px;
            border-radius: 8px;
            display: inline-block;
            margin-bottom: 4px;
        }

        .event-title {
            font-size: 1.25rem;
            font-weight: 800;
            margin: 0;
            line-height: 1.2;
            letter-spacing: -0.5px;
        }

        .event-desc {
            font-size: 0.95rem;
            color: #3A3A3C;
            line-height: 1.5;
            margin-bottom: 12px;
            text-align: justify;
        }

        .tips-box {
            font-size: 0.85rem;
            background: #FFF9E6;
            color: #8a6d3b;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 3px solid var(--yellow);
            line-height: 1.4;
        }

        /* BUTTONS */
        .buttons-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .btn {
            text-decoration: none;
            padding: 8px 14px;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: 0.2s;
            border: none;
            cursor: pointer;
        }

        .btn-map {
            background: rgba(0, 122, 255, 0.1);
            color: var(--blue);
        }

        .btn-insta {
            background: rgba(175, 82, 222, 0.1);
            color: var(--purple);
        }

        .btn-wpp {
            background: rgba(52, 199, 89, 0.1);
            color: var(--green);
        }

        /* EXTRAS */
        .extras-section {
            margin-top: 40px;
            margin-bottom: 20px;
        }

        .extras-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }

        .extra-card {
            background: rgba(255, 255, 255, 0.8);
            border: 2px dashed #C7C7CC;
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        /* MENU */
        .recipe-card {
            background: var(--bg-card);
            border-radius: 18px;
            overflow: hidden;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .recipe-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .recipe-content {
            padding: 20px;
        }

        .step {
            display: flex;
            gap: 15px;
            margin-bottom: 12px;
        }

        .step-num {
            background: var(--orange);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            flex-shrink: 0;
        }

        /* PEOPLE & SUMMARY */
        .people-group {
            margin-bottom: 30px;
        }

        .people-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .people-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .person-card {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
            position: relative;
        }

        .wpp-btn {
            background: #25D366;
            color: white;
            border: none;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            margin-left: auto;
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
            transition: transform 0.2s;
            flex-shrink: 0;
        }

        .wpp-btn:hover {
            transform: scale(1.1);
        }

        .wpp-icon {
            width: 22px;
            height: 22px;
            fill: white;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--blue), var(--teal));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .avatar.purple {
            background: linear-gradient(135deg, var(--purple), #FF2D55);
        }

        .avatar.gray {
            background: #C7C7CC;
        }

        .overview-row {
            display: flex;
            margin-bottom: 20px;
            background: var(--bg-card);
            border-radius: 16px;
            padding: 15px;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
            border-left: 4px solid var(--blue);
        }

        .overview-date {
            text-align: center;
            padding-right: 15px;
            border-right: 1px solid #eee;
            margin-right: 15px;
            min-width: 60px;
        }

        .overview-day {
            font-weight: 800;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .overview-wday {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .overview-content {
            flex: 1;
        }

        .night-badge {
            margin-top: 8px;
            font-size: 0.85rem;
            color: var(--purple);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* SHOPPING LIST */
        .shopping-header {
            background: #1C1C1E;
            color: white;
            padding: 20px;
            border-radius: 18px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .total-display {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .shop-item {
            display: flex;
            align-items: center;
            background: white;
            padding: 12px 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            transition: 0.2s;
            border: 1px solid #eee;
        }

        .shop-item.checked {
            background: #f9f9f9;
            opacity: 0.6;
        }

        .shop-check {
            width: 24px;
            min-width: 24px;
            /* Garante que n√£o esmague */
            height: 24px;
            margin-right: 12px;
            cursor: pointer;
            border-radius: 6px;
            border: 2px solid #ccc;
            display: grid;
            place-items: center;
            background: white;
            flex-shrink: 0;
            /* Impede encolhimento */
        }

        .shop-item.checked .shop-check {
            background: var(--green);
            border-color: var(--green);
            color: white;
        }

        .shop-name {
            flex: 1;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .shop-item.checked .shop-name {
            text-decoration: line-through;
        }

        .shop-price-container {
            width: 100px;
            background: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 8px;
            display: flex;
            align-items: center;
            padding: 0 8px;
        }

        .shop-currency {
            font-size: 0.8rem;
            color: #888;
            margin-right: 4px;
        }

        .shop-price-input {
            width: 100%;
            border: none;
            background: transparent;
            text-align: right;
            font-weight: 600;
            font-size: 0.9rem;
            outline: none;
            padding: 8px 0;
        }

        /* ... (Mantenha o estilo .shopping-header existente) ... */

        /* NOVO: Estilo para adicionar item */
        .add-item-row {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .add-input {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid #ddd;
            font-size: 1rem;
            outline: none;
        }

        .add-btn {
            background: var(--blue);
            color: white;
            border: none;
            width: 50px;
            border-radius: 12px;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ATUALIZADO: Estilo do item da lista para permitir edi√ß√£o */
        .shop-name-input {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 0.95rem;
            font-family: inherit;
            color: var(--text-primary);
            padding: 5px;
            margin: 0 5px;
        }

        .shop-name-input:focus {
            background: #f0f0f0;
            border-radius: 5px;
            outline: none;
        }

        .shop-item.checked .shop-name-input {
            text-decoration: line-through;
            color: #aaa;
        }

        /* NOVO: Bot√£o de deletar estilo X */
        .delete-btn {
            background: rgba(255, 59, 48, 0.1);
            color: var(--red);
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 8px;
            flex-shrink: 0;
            transition: 0.2s;
        }

        .delete-btn:hover {
            background: var(--red);
            color: white;
            transform: scale(1.1);
        }

        /* DOCK NAVIGATION */
        .dock {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            max-width: 500px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 8px 10px;
            border-radius: 25px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .dock-item {
            flex: 1;
            text-align: center;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.65rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding-bottom: 2px;
        }

        .dock-item.active {
            color: var(--blue);
        }

        .dock-icon {
            font-size: 1.4rem;
            transition: 0.2s;
        }

        .dock-item.active .dock-icon {
            transform: translateY(-3px);
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>

    <div id="layout-container">
        <!-- MAPA -->
        <button class="map-toggle-btn" onclick="toggleMap()">
            <span>üó∫Ô∏è</span> <span id="map-toggle-text">Ocultar</span>
        </button>
        <div id="map-area"></div>

        <!-- CONTE√öDO -->
        <div id="content-area">

            <!-- VIEW: ROTEIRO -->
            <div id="view-timeline">
                <div class="app-header">
                    <h1 class="app-title">Trip Cabo Frio üåä</h1>
                    <div class="days-scroller" id="days-container"></div>
                </div>
                <div id="day-content"></div>
            </div>

            <!-- VIEW: GALERA -->
            <div id="view-people" class="hidden">
                <h1 class="app-title">A Galera üë•</h1>
                <div class="people-group">
                    <div class="people-title">Confirmados (29/Dez a 03/Jan)</div>
                    <div class="people-list">
                        <div class="person-card">
                            <div class="avatar">L</div>
                            <div>
                                <div style="font-weight:600">Lan</div>
                                <div style="font-size:0.85rem; color:var(--text-secondary); white-space:nowrap;">(31)
                                    99994-2613</div>
                            </div>
                            <a href="https://wa.me/5531999942613" target="_blank" class="wpp-btn" aria-label="WhatsApp">
                                <svg viewBox="0 0 24 24" class="wpp-icon">
                                    <path
                                        d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21 5.46 0 9.91-4.45 9.91-9.91 0-2.65-1.03-5.14-2.9-7.01C17.18 3.03 14.69 2 12.04 2zM12.05 20.21c-1.5 0-2.96-.39-4.27-1.15l-.3-.18-3.11.82.83-3.04-.2-.31c-.82-1.31-1.26-2.83-1.26-4.42 0-4.61 3.75-8.36 8.36-8.36 2.23 0 4.33.87 5.91 2.45 1.58 1.58 2.45 3.68 2.45 5.91 0 4.61-3.74 8.36-8.35 8.36-.01-.08-.03-.08-.06-.08zm4.53-6.29c-.25-.12-1.47-.72-1.69-.81-.23-.08-.39-.12-.56.12-.17.25-.64.81-.78.97-.14.17-.29.19-.54.06-.25-.12-1.05-.39-1.99-1.23-.74-.66-1.23-1.47-1.38-1.72-.14-.25-.02-.38.11-.51.11-.11.23-.29.35-.44.12-.15.17-.25.25-.42.08-.17.04-.31-.02-.44-.06-.12-.56-1.34-.76-1.84-.2-.48-.41-.42-.56-.43h-.48c-.17 0-.44.06-.67.31-.23.25-.87.85-.87 2.07 0 1.22.89 2.39 1.01 2.56.12.17 1.75 2.67 4.23 3.74 2.48 1.07 2.48.71 2.94.66.46-.05 1.47-.6 1.67-1.18.2-.58.2-1.07.14-1.18-.06-.11-.22-.17-.47-.3z" />
                                </svg>
                            </a>
                        </div>
                        <div class="person-card">
                            <div class="avatar">B</div>
                            <div>
                                <div style="font-weight:600">Bru</div>
                                <div style="font-size:0.85rem; color:var(--text-secondary); white-space:nowrap;">(31)
                                    99569-5819</div>
                            </div>
                            <a href="https://wa.me/5531995695819" target="_blank" class="wpp-btn" aria-label="WhatsApp">
                                <svg viewBox="0 0 24 24" class="wpp-icon">
                                    <path
                                        d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21 5.46 0 9.91-4.45 9.91-9.91 0-2.65-1.03-5.14-2.9-7.01C17.18 3.03 14.69 2 12.04 2zM12.05 20.21c-1.5 0-2.96-.39-4.27-1.15l-.3-.18-3.11.82.83-3.04-.2-.31c-.82-1.31-1.26-2.83-1.26-4.42 0-4.61 3.75-8.36 8.36-8.36 2.23 0 4.33.87 5.91 2.45 1.58 1.58 2.45 3.68 2.45 5.91 0 4.61-3.74 8.36-8.35 8.36-.01-.08-.03-.08-.06-.08zm4.53-6.29c-.25-.12-1.47-.72-1.69-.81-.23-.08-.39-.12-.56.12-.17.25-.64.81-.78.97-.14.17-.29.19-.54.06-.25-.12-1.05-.39-1.99-1.23-.74-.66-1.23-1.47-1.38-1.72-.14-.25-.02-.38.11-.51.11-.11.23-.29.35-.44.12-.15.17-.25.25-.42.08-.17.04-.31-.02-.44-.06-.12-.56-1.34-.76-1.84-.2-.48-.41-.42-.56-.43h-.48c-.17 0-.44.06-.67.31-.23.25-.87.85-.87 2.07 0 1.22.89 2.39 1.01 2.56.12.17 1.75 2.67 4.23 3.74 2.48 1.07 2.48.71 2.94.66.46-.05 1.47-.6 1.67-1.18.2-.58.2-1.07.14-1.18-.06-.11-.22-.17-.47-.3z" />
                                </svg>
                            </a>
                        </div>
                        <div class="person-card">
                            <div class="avatar">M</div>
                            <div>
                                <div style="font-weight:600">Max</div>
                                <div style="font-size:0.85rem; color:var(--text-secondary); white-space:nowrap;">(31)
                                    99371-6033</div>
                            </div>
                            <a href="https://wa.me/5531993716033" target="_blank" class="wpp-btn" aria-label="WhatsApp">
                                <svg viewBox="0 0 24 24" class="wpp-icon">
                                    <path
                                        d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21 5.46 0 9.91-4.45 9.91-9.91 0-2.65-1.03-5.14-2.9-7.01C17.18 3.03 14.69 2 12.04 2zM12.05 20.21c-1.5 0-2.96-.39-4.27-1.15l-.3-.18-3.11.82.83-3.04-.2-.31c-.82-1.31-1.26-2.83-1.26-4.42 0-4.61 3.75-8.36 8.36-8.36 2.23 0 4.33.87 5.91 2.45 1.58 1.58 2.45 3.68 2.45 5.91 0 4.61-3.74 8.36-8.35 8.36-.01-.08-.03-.08-.06-.08zm4.53-6.29c-.25-.12-1.47-.72-1.69-.81-.23-.08-.39-.12-.56.12-.17.25-.64.81-.78.97-.14.17-.29.19-.54.06-.25-.12-1.05-.39-1.99-1.23-.74-.66-1.23-1.47-1.38-1.72-.14-.25-.02-.38.11-.51.11-.11.23-.29.35-.44.12-.15.17-.25.25-.42.08-.17.04-.31-.02-.44-.06-.12-.56-1.34-.76-1.84-.2-.48-.41-.42-.56-.43h-.48c-.17 0-.44.06-.67.31-.23.25-.87.85-.87 2.07 0 1.22.89 2.39 1.01 2.56.12.17 1.75 2.67 4.23 3.74 2.48 1.07 2.48.71 2.94.66.46-.05 1.47-.6 1.67-1.18.2-.58.2-1.07.14-1.18-.06-.11-.22-.17-.47-.3z" />
                                </svg>
                            </a>
                        </div>
                        <div class="person-card">
                            <div class="avatar">J</div>
                            <div>
                                <div style="font-weight:600">Jana</div>
                                <div style="font-size:0.85rem; color:var(--text-secondary); white-space:nowrap;">(55)
                                    98427-2098</div>
                            </div>
                            <a href="https://wa.me/5555984272098" target="_blank" class="wpp-btn" aria-label="WhatsApp">
                                <svg viewBox="0 0 24 24" class="wpp-icon">
                                    <path
                                        d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21 5.46 0 9.91-4.45 9.91-9.91 0-2.65-1.03-5.14-2.9-7.01C17.18 3.03 14.69 2 12.04 2zM12.05 20.21c-1.5 0-2.96-.39-4.27-1.15l-.3-.18-3.11.82.83-3.04-.2-.31c-.82-1.31-1.26-2.83-1.26-4.42 0-4.61 3.75-8.36 8.36-8.36 2.23 0 4.33.87 5.91 2.45 1.58 1.58 2.45 3.68 2.45 5.91 0 4.61-3.74 8.36-8.35 8.36-.01-.08-.03-.08-.06-.08zm4.53-6.29c-.25-.12-1.47-.72-1.69-.81-.23-.08-.39-.12-.56.12-.17.25-.64.81-.78.97-.14.17-.29.19-.54.06-.25-.12-1.05-.39-1.99-1.23-.74-.66-1.23-1.47-1.38-1.72-.14-.25-.02-.38.11-.51.11-.11.23-.29.35-.44.12-.15.17-.25.25-.42.08-.17.04-.31-.02-.44-.06-.12-.56-1.34-.76-1.84-.2-.48-.41-.42-.56-.43h-.48c-.17 0-.44.06-.67.31-.23.25-.87.85-.87 2.07 0 1.22.89 2.39 1.01 2.56.12.17 1.75 2.67 4.23 3.74 2.48 1.07 2.48.71 2.94.66.46-.05 1.47-.6 1.67-1.18.2-.58.2-1.07.14-1.18-.06-.11-.22-.17-.47-.3z" />
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="people-group">
                    <div class="people-title">Confirmados (30/Dez a 03/Jan)</div>
                    <div class="people-list">
                        <div class="person-card">
                            <div class="avatar purple">G</div>
                            <div>
                                <div style="font-weight:600">Gustavo</div>
                                <div style="font-size:0.85rem; color:var(--text-secondary); white-space:nowrap;">(31)
                                    98771-2179</div>
                            </div>
                            <a href="https://wa.me/5531987712179" target="_blank" class="wpp-btn" aria-label="WhatsApp">
                                <svg viewBox="0 0 24 24" class="wpp-icon">
                                    <path
                                        d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21 5.46 0 9.91-4.45 9.91-9.91 0-2.65-1.03-5.14-2.9-7.01C17.18 3.03 14.69 2 12.04 2zM12.05 20.21c-1.5 0-2.96-.39-4.27-1.15l-.3-.18-3.11.82.83-3.04-.2-.31c-.82-1.31-1.26-2.83-1.26-4.42 0-4.61 3.75-8.36 8.36-8.36 2.23 0 4.33.87 5.91 2.45 1.58 1.58 2.45 3.68 2.45 5.91 0 4.61-3.74 8.36-8.35 8.36-.01-.08-.03-.08-.06-.08zm4.53-6.29c-.25-.12-1.47-.72-1.69-.81-.23-.08-.39-.12-.56.12-.17.25-.64.81-.78.97-.14.17-.29.19-.54.06-.25-.12-1.05-.39-1.99-1.23-.74-.66-1.23-1.47-1.38-1.72-.14-.25-.02-.38.11-.51.11-.11.23-.29.35-.44.12-.15.17-.25.25-.42.08-.17.04-.31-.02-.44-.06-.12-.56-1.34-.76-1.84-.2-.48-.41-.42-.56-.43h-.48c-.17 0-.44.06-.67.31-.23.25-.87.85-.87 2.07 0 1.22.89 2.39 1.01 2.56.12.17 1.75 2.67 4.23 3.74 2.48 1.07 2.48.71 2.94.66.46-.05 1.47-.6 1.67-1.18.2-.58.2-1.07.14-1.18-.06-.11-.22-.17-.47-.3z" />
                                </svg>
                            </a>
                        </div>
                        <div class="person-card">
                            <div class="avatar purple">S</div>
                            <div>
                                <div style="font-weight:600">Steffi</div>
                                <div style="font-size:0.85rem; color:var(--text-secondary); white-space:nowrap;">(31)
                                    99477-2898</div>
                            </div>
                            <a href="https://wa.me/5531994772898" target="_blank" class="wpp-btn" aria-label="WhatsApp">
                                <svg viewBox="0 0 24 24" class="wpp-icon">
                                    <path
                                        d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21 5.46 0 9.91-4.45 9.91-9.91 0-2.65-1.03-5.14-2.9-7.01C17.18 3.03 14.69 2 12.04 2zM12.05 20.21c-1.5 0-2.96-.39-4.27-1.15l-.3-.18-3.11.82.83-3.04-.2-.31c-.82-1.31-1.26-2.83-1.26-4.42 0-4.61 3.75-8.36 8.36-8.36 2.23 0 4.33.87 5.91 2.45 1.58 1.58 2.45 3.68 2.45 5.91 0 4.61-3.74 8.36-8.35 8.36-.01-.08-.03-.08-.06-.08zm4.53-6.29c-.25-.12-1.47-.72-1.69-.81-.23-.08-.39-.12-.56.12-.17.25-.64.81-.78.97-.14.17-.29.19-.54.06-.25-.12-1.05-.39-1.99-1.23-.74-.66-1.23-1.47-1.38-1.72-.14-.25-.02-.38.11-.51.11-.11.23-.29.35-.44.12-.15.17-.25.25-.42.08-.17.04-.31-.02-.44-.06-.12-.56-1.34-.76-1.84-.2-.48-.41-.42-.56-.43h-.48c-.17 0-.44.06-.67.31-.23.25-.87.85-.87 2.07 0 1.22.89 2.39 1.01 2.56.12.17 1.75 2.67 4.23 3.74 2.48 1.07 2.48.71 2.94.66.46-.05 1.47-.6 1.67-1.18.2-.58.2-1.07.14-1.18-.06-.11-.22-.17-.47-.3z" />
                                </svg>
                            </a>

                        </div>
                    </div>
                </div>
                <div class="people-group">
                    <div class="people-title">Indefinidos</div>
                    <div class="people-list">
                        <div class="person-card">
                            <div class="avatar gray">K</div>
                            <div>
                                <div style="font-weight:600">Keven</div>
                                <div style="font-size:0.85rem; color:var(--text-secondary); white-space:nowrap;">(31)
                                    99670-4870</div>
                            </div>
                            <a href="https://wa.me/5531996704870" target="_blank" class="wpp-btn" aria-label="WhatsApp">
                                <svg viewBox="0 0 24 24" class="wpp-icon">
                                    <path
                                        d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21 5.46 0 9.91-4.45 9.91-9.91 0-2.65-1.03-5.14-2.9-7.01C17.18 3.03 14.69 2 12.04 2zM12.05 20.21c-1.5 0-2.96-.39-4.27-1.15l-.3-.18-3.11.82.83-3.04-.2-.31c-.82-1.31-1.26-2.83-1.26-4.42 0-4.61 3.75-8.36 8.36-8.36 2.23 0 4.33.87 5.91 2.45 1.58 1.58 2.45 3.68 2.45 5.91 0 4.61-3.74 8.36-8.35 8.36-.01-.08-.03-.08-.06-.08zm4.53-6.29c-.25-.12-1.47-.72-1.69-.81-.23-.08-.39-.12-.56.12-.17.25-.64.81-.78.97-.14.17-.29.19-.54.06-.25-.12-1.05-.39-1.99-1.23-.74-.66-1.23-1.47-1.38-1.72-.14-.25-.02-.38.11-.51.11-.11.23-.29.35-.44.12-.15.17-.25.25-.42.08-.17.04-.31-.02-.44-.06-.12-.56-1.34-.76-1.84-.2-.48-.41-.42-.56-.43h-.48c-.17 0-.44.06-.67.31-.23.25-.87.85-.87 2.07 0 1.22.89 2.39 1.01 2.56.12.17 1.75 2.67 4.23 3.74 2.48 1.07 2.48.71 2.94.66.46-.05 1.47-.6 1.67-1.18.2-.58.2-1.07.14-1.18-.06-.11-.22-.17-.47-.3z" />
                                </svg>
                            </a>
                        </div>
                        <div class="person-card">
                            <div class="avatar gray">K</div>
                            <div>
                                <div style="font-weight:600">Karla</div>
                                <div style="font-size:0.85rem; color:var(--text-secondary); white-space:nowrap;">(21)
                                    00000-0000</div>
                            </div>
                            <!-- Assuming 00000000 is invalid, maybe no button? Or just button to nowhere? Ill exclude button or add it for consistency. Checking 21 ddd -> 5521000... -->
                            <a href="#" class="wpp-btn" style="opacity:0.3; cursor:not-allowed">
                                <svg viewBox="0 0 24 24" class="wpp-icon">
                                    <path
                                        d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21 5.46 0 9.91-4.45 9.91-9.91 0-2.65-1.03-5.14-2.9-7.01C17.18 3.03 14.69 2 12.04 2zM12.05 20.21c-1.5 0-2.96-.39-4.27-1.15l-.3-.18-3.11.82.83-3.04-.2-.31c-.82-1.31-1.26-2.83-1.26-4.42 0-4.61 3.75-8.36 8.36-8.36 2.23 0 4.33.87 5.91 2.45 1.58 1.58 2.45 3.68 2.45 5.91 0 4.61-3.74 8.36-8.35 8.36-.01-.08-.03-.08-.06-.08zm4.53-6.29c-.25-.12-1.47-.72-1.69-.81-.23-.08-.39-.12-.56.12-.17.25-.64.81-.78.97-.14.17-.29.19-.54.06-.25-.12-1.05-.39-1.99-1.23-.74-.66-1.23-1.47-1.38-1.72-.14-.25-.02-.38.11-.51.11-.11.23-.29.35-.44.12-.15.17-.25.25-.42.08-.17.04-.31-.02-.44-.06-.12-.56-1.34-.76-1.84-.2-.48-.41-.42-.56-.43h-.48c-.17 0-.44.06-.67.31-.23.25-.87.85-.87 2.07 0 1.22.89 2.39 1.01 2.56.12.17 1.75 2.67 4.23 3.74 2.48 1.07 2.48.71 2.94.66.46-.05 1.47-.6 1.67-1.18.2-.58.2-1.07.14-1.18-.06-.11-.22-.17-.47-.3z" />
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: RESUMO -->
            <div id="view-summary" class="hidden">
                <h1 class="app-title">Resum√£o & Vibe üí°</h1>
                <div class="overview-row">
                    <div class="overview-date">
                        <div class="overview-day">29</div>
                        <div class="overview-wday">Seg</div>
                    </div>
                    <div class="overview-content">
                        <div style="font-weight:700;">Petr√≥polis & Chegada</div>
                        <div style="font-size:0.85rem; color:#666;">Almo√ßo alem√£o e organiza√ß√£o da casa.</div>
                        <div class="night-badge">üåô Jantar + Quebra-Gelo</div>
                    </div>
                </div>
                <div class="overview-row" style="border-left-color: var(--teal)">
                    <div class="overview-date">
                        <div class="overview-day">30</div>
                        <div class="overview-wday">Ter</div>
                    </div>
                    <div class="overview-content">
                        <div style="font-weight:700;">Per√≥ & Compras</div>
                        <div style="font-size:0.85rem; color:#666;">Abastecimento da casa e praia relax.</div>
                        <div class="night-badge">üéÆ Strogonoff + Mario Kart</div>
                    </div>
                </div>
                <div class="overview-row" style="border-left-color: var(--purple)">
                    <div class="overview-date">
                        <div class="overview-day">31</div>
                        <div class="overview-wday">Qua</div>
                    </div>
                    <div class="overview-content">
                        <div style="font-weight:700;">Mar & Virada</div>
                        <div style="font-size:0.85rem; color:#666;">Passeio de barco e Reveillon.</div>
                        <div class="night-badge">‚ú® Churrasco + Fogos</div>
                    </div>
                </div>
                <div class="overview-row" style="border-left-color: var(--orange)">
                    <div class="overview-date">
                        <div class="overview-day">01</div>
                        <div class="overview-wday">Qui</div>
                    </div>
                    <div class="overview-content">
                        <div style="font-weight:700;">Gerib√° & Pedras</div>
                        <div style="font-size:0.85rem; color:#666;">Dia de B√∫zios completo.</div>
                        <div class="night-badge">üçø Lasanha + Relax</div>
                    </div>
                </div>
                <div class="overview-row" style="border-left-color: var(--green)">
                    <div class="overview-date">
                        <div class="overview-day">02</div>
                        <div class="overview-wday">Sex</div>
                    </div>
                    <div class="overview-content">
                        <div style="font-weight:700;">Forte & Canal</div>
                        <div style="font-size:0.85rem; color:#666;">Pontos tur√≠sticos e encerramento.</div>
                        <div class="night-badge">üèÜ Burger + "Oscar"</div>
                    </div>
                </div>
            </div>

            <!-- VIEW: MENU -->
            <div id="view-menu" class="hidden">
                <h1 class="app-title">Menu & Receitas üçΩÔ∏è</h1>
                <div id="menu-container"></div>
                <h2 style="margin: 30px 0 15px">Bar da Casa üçπ</h2>
                <div class="event-card" style="border-left-color: var(--purple)">
                    <h3 class="event-title">Batida de Maracuj√°</h3>
                    <p class="event-desc">1 lata Leite Condensado + 1 medida Vodka + 1 medida Suco Maguary + Gelo. Bater
                        no liquidificador.</p>
                </div>
                <div class="event-card" style="border-left-color: var(--red)">
                    <h3 class="event-title">Balena Fizz</h3>
                    <p class="event-desc">Copo cheio de gelo. 50ml Balena. Completar com T√¥nica. Espremer meio lim√£o.
                    </p>
                </div>
                <div class="event-card" style="border-left-color: var(--teal)">
                    <h3 class="event-title">Caipivodca</h3>
                    <p class="event-desc">50ml Vodka + Fruta (Lim√£o/Morango/Kiwi) + 2 colheres de A√ß√∫car + Gelo.</p>
                </div>
            </div>

            <!-- VIEW: COMPRAS -->
            <div id="view-shopping" class="hidden">
                <h1 class="app-title">Lista de Compras üõí</h1>

                <div class="shopping-header">
                    <div style="opacity:0.8; font-size:0.9rem">Total Estimado</div>
                    <div class="total-display" id="total-price">R$ 0,00</div>
                    <div style="opacity:0.8; font-size:0.9rem">R$ <span id="split-price">0,00</span> por pessoa (6)
                    </div>
                </div>

                <!-- ADICIONE ISSO AQUI: Campo para adicionar novos itens -->
                <div class="add-item-row">
                    <input type="text" id="new-item-input" class="add-input" placeholder="Adicionar novo item...">
                    <button class="add-btn" onclick="addNewItem()">+</button>
                </div>

                <div id="shopping-list-container"></div>
            </div>

            <!-- VIEW: MALAS -->
            <div id="view-packing" class="hidden">
                <h1 class="app-title">O que levar? üéí</h1>
                <div id="packing-list-container"></div>
            </div>

        </div>
    </div>

    <!-- DOCK NAV -->
    <div class="dock">
        <div class="dock-item active" onclick="switchTab('timeline')">
            <span class="dock-icon">üìÖ</span> Roteiro
        </div>
        <div class="dock-item" onclick="switchTab('people')">
            <span class="dock-icon">üë•</span> Galera
        </div>
        <div class="dock-item" onclick="switchTab('summary')">
            <span class="dock-icon">üí°</span> Resumo
        </div>
        <div class="dock-item" onclick="switchTab('menu')">
            <span class="dock-icon">üçî</span> Menu
        </div>
        <div class="dock-item" onclick="switchTab('shopping')">
            <span class="dock-icon">üõí</span> Compras
        </div>
        <div class="dock-item" onclick="switchTab('packing')">
            <span class="dock-icon">üéí</span> Malas
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        // --- DADOS COMPLETOS ---
        const homeCoords = [-22.8635, -41.9850];

        const db = {
            "29/12": {
                label: "29 Seg", color: "var(--blue)", mapFocus: [-22.5112, -43.1779], zoom: 13,
                summary: "O in√≠cio da aventura! Acordaremos cedo para render o dia. Foco em aproveitar a vibe hist√≥rica de Petr√≥polis para um almo√ßo especial e quebrar a viagem longa.",
                checklist: "üéí Levar na m√£o (fora da mala): Agasalho leve (Petr√≥polis esfria), √ìculos de sol, Carteira, Playlist baixada no celular.",
                events: [
                    {
                        time: "06:00 - 11:30",
                        title: "Viagem BH -> Petr√≥polis",
                        emoji: "üöó",
                        type: "travel",
                        desc: "Sa√≠da antecipada para evitar o tr√¢nsito da sa√≠da de BH. Rota via BR-040. Faremos uma parada t√©cnica r√°pida em Juiz de Fora apenas para banheiro/caf√© se necess√°rio.",
                        tips: "Monitorem o grupo do Wpp para avisar da sa√≠da. Waze ligado o tempo todo.",
                        maps: "https://www.google.com/maps/search/?api=1&query=Petropolis+Centro"
                    },
                    {
                        time: "11:30 - 13:30",
                        title: "Almo√ßo: Cervejaria Bohemia",
                        emoji: "üçª",
                        type: "food",
                        desc: "O maior complexo cervejeiro da regi√£o serrana. O restaurante fica no topo da f√°brica, com ambiente hist√≥rico e sofisticado. Servem comida alem√£ t√≠pica e pratos brasileiros.",
                        tips: "Pe√ßam a 'R√©gua de Degusta√ß√£o' (vem v√°rios copinhos de chopp) e o Croquete de Carne como entrada. Estacionamento pr√≥ximo √© pago e concorrido.",
                        maps: "https://www.google.com/maps/search/?api=1&query=Cervejaria+Bohemia+Petropolis",
                        insta: "https://www.instagram.com/cervejariabohemia",
                        coords: [-22.5137, -43.1815]
                    },
                    {
                        time: "13:30 - 14:30",
                        title: "Pal√°cio de Cristal & Centro",
                        emoji: "üíé",
                        type: "culture",
                        desc: "Passeio a p√© para fazer a digest√£o. √â uma estrutura de vidro pr√©-moldada encomendada pelo Conde D'Eu. Os jardins s√£o lindos para fotos.",
                        tips: "A entrada √© gratuita. √ìtimo cen√°rio para foto em grupo.",
                        maps: "https://www.google.com/maps/search/?api=1&query=Palacio+de+Cristal+Petropolis",
                        coords: [-22.5126, -43.1822]
                    },
                    {
                        time: "14:30 - 15:00",
                        title: "Chocolates Katz",
                        emoji: "üç´",
                        type: "food",
                        desc: "Tradicional chocolataria da serra. Parada estrat√©gica para um caf√© e garantir a sobremesa da viagem.",
                        tips: "O tubinho de wafer com chocolate √© cl√°ssico. Levem uma barra para comer no carro.",
                        maps: "https://www.google.com/maps/search/?api=1&query=Katz+Chocolates+Petropolis",
                        coords: [-22.5100, -43.1760]
                    },
                    {
                        time: "15:00 - 18:30",
                        title: "Descida da Serra -> Cabo Frio",
                        emoji: "üõ£Ô∏è",
                        type: "travel",
                        desc: "Trecho final da viagem. Aten√ß√£o redobrada na Via Lagos, pois costuma ter radar e fiscaliza√ß√£o.",
                        maps: "https://www.google.com/maps/search/?api=1&query=Cabo+Frio"
                    },
                    {
                        time: "19:00 - 22:00",
                        title: "Check-in & Jantar",
                        emoji: "üçù",
                        type: "home",
                        desc: "Entrada na casa (Alameda Treze). Divis√£o de tarefas: uma equipe faz a limpeza expressa (tirar poeira, arrumar camas) e a outra prepara o Penne R√∫stico.",
                        coords: homeCoords,
                        maps: "https://www.google.com/maps/search/?api=1&query=Alameda+Treze+511+Jardim+Pero+Cabo+Frio"
                    }
                ],
                extras: [
                    { title: "Catedral S√£o Pedro", desc: "G√≥tica e imponente. Fica no caminho do centro.", maps: "https://www.google.com/maps/search/?api=1&query=Catedral+Sao+Pedro+de+Alcantara+Petropolis" },
                    { title: "Museu de Cera", desc: "Divertido e r√°pido, perto da Bohemia.", maps: "https://www.google.com/maps/search/?api=1&query=Museu+de+Cera+Petropolis" }
                ]
            },
            "30/12": {
                label: "30 Ter", color: "var(--teal)", mapFocus: [-22.8680, -42.0280], zoom: 12,
                summary: "Dia de log√≠stica e reconhecimento. Manh√£ dedicada a encher a geladeira (o mercado lota tarde). Tarde inteira para relaxar na praia do Per√≥ sem pressa.",
                checklist: "üõí Lista de Compras no app, Sacolas retorn√°veis, Cooler com Gelo (comprar l√°), Cadeira de praia e Som.",
                events: [
                    { time: "08:30 - 10:30", title: "Mercado Atacad√£o", emoji: "üõí", type: "travel", desc: "Compra grande da semana. Bebidas, carnes para churrasco do dia 31, itens de caf√© da manh√£ e limpeza.", tips: "IMPORTANTE: Comprar CARV√ÉO e GELO hoje! No dia 31 zera o estoque na cidade.", maps: "https://www.google.com/maps/search/?api=1&query=Atacadao+Cabo+Frio", coords: [-22.8680, -42.0280] },
                    { time: "11:00 - 16:30", title: "Praia do Per√≥", emoji: "üèñÔ∏è", type: "beach", desc: "Praia com certifica√ß√£o internacional 'Bandeira Azul'. √Ågua limp√≠ssima, faixa de areia extensa e menos muvuca que a Praia do Forte.", tips: "Fiquem pr√≥ximos ao 'Quiosque do Peixe'. Levem o cooler para economizar na bebida.", maps: "https://www.google.com/maps/search/?api=1&query=Praia+do+Pero+Cabo+Frio", coords: [-22.8675, -41.9790] },
                    { time: "13:00 - 14:30", title: "Almo√ßo: Restaurante do Z√©", emoji: "üç§", type: "food", desc: "P√© na areia (quase). Pratos honestos de peixe frito, camar√£o e guarni√ß√µes bem servidas.", tips: "O prato 'Peixe √† Moda' costuma servir bem 2 a 3 pessoas.", maps: "https://www.google.com/maps/search/?api=1&query=Restaurante+do+Ze+Praia+do+Pero", coords: [-22.8690, -41.9780] },
                    { time: "16:30 - 18:00", title: "P√¥r do Sol: Praia das Conchas", emoji: "üêö", type: "beach", desc: "Caminhada leve (10 min) pelo canto direito do Per√≥ at√© as Conchas. √Ågua calma, ideal para boiar.", tips: "Subam no morrinho que divide as duas praias para ter o visual panor√¢mico do p√¥r do sol.", maps: "https://www.google.com/maps/search/?api=1&query=Praia+das+Conchas+Cabo+Frio", coords: [-22.8695, -41.9700] },
                    { time: "20:00 - 00:00", title: "Strogonoff & Games", emoji: "üé≤", type: "home", desc: "Noite de competi√ß√£o na casa: Mario Party, Uno e Baralho. Jantar reconfortante de Strogonoff.", tips: "Deixar o Switch carregando durante o dia." }
                ],
                extras: [
                    { title: "Shopping Park Lagos", desc: "Op√ß√£o moderna para passear √† noite se chover.", maps: "https://www.google.com/maps/search/?api=1&query=Shopping+Park+Lagos" },
                    { title: "Mirante da Guia", desc: "Vista panor√¢mica da cidade no p√¥r do sol.", maps: "https://www.google.com/maps/search/?api=1&query=Morro+da+Guia+Cabo+Frio" }
                ]
            },
            "31/12": {
                label: "31 Qua", color: "var(--purple)", mapFocus: [-22.8850, -42.0190], zoom: 13,
                summary: "O Grande Dia! Manh√£ de aventura com passeio de barco e mergulho. Tarde no bairro hist√≥rico charmoso. Noite de festa e Reveillon na praia.",
                checklist: "üíä Dramin (tomar 30min antes do barco), Protetor Solar, Toalha, Roupa Branca passada, Champanhe gelando desde cedo.",
                events: [
                    { time: "09:00 - 13:00", title: "Passeio de Barco + Mergulho", emoji: "üö§", type: "culture", desc: "Sa√≠da do Boulevard Canal. Roteiro cl√°ssico: Ilha do Japon√™s, passagem pelo Forte S√£o Mateus (vista mar) e parada longa na Ilha dos Papagaios.", tips: "Agendar com anteced√™ncia. Levar lanches leves. Visual caribenho na Ilha dos Papagaios.", maps: "https://www.google.com/maps/search/?api=1&query=Boulevard+Canal+Cabo+Frio", coords: [-22.8850, -42.0190] },
                    { time: "13:30 - 15:30", title: "Almo√ßo: Bairro da Passagem", emoji: "üèòÔ∏è", type: "food", desc: "O 'Centro Hist√≥rico' de Cabo Frio, lembra Paraty. Charme colonial, ruas de pedra e alta gastronomia.", tips: "Restaurantes recomendados: 'Gal√°pagos' ou 'Escrit√≥rio do Chef'. √ìtimo para fotos.", maps: "https://www.google.com/maps/search/?api=1&query=Bairro+da+Passagem+Cabo+Frio", insta: "https://www.instagram.com/bairrodapassagem", coords: [-22.8830, -42.0150] },
                    { time: "17:00 - 22:00", title: "Churrasco Pr√©-Reveillon", emoji: "üî•", type: "home", desc: "In√≠cio dos trabalhos na churrasqueira. Caipirinhas, m√∫sica alta e prepara√ß√£o para a virada.", tips: "Colocar espumante para gelar √†s 20h no m√°ximo.", coords: homeCoords },
                    { time: "23:30 - 01:30", title: "Virada na Praia do Per√≥", emoji: "üéÜ", type: "beach", desc: "Fogos na areia perto de casa. Ambiente mais seguro, familiar e tranquilo que a muvuca da Praia do Forte.", tips: "Vamos a p√© ou de carro (estacionando perto). Levar apenas o essencial.", maps: "https://www.google.com/maps/search/?api=1&query=Praia+do+Pero+Cabo+Frio", coords: [-22.8675, -41.9790] }
                ],
                extras: [
                    { title: "Rua dos Biqu√≠nis", desc: "Shopping a c√©u aberto na Gamboa (na volta do barco).", maps: "https://www.google.com/maps/search/?api=1&query=Rua+dos+Biquinis+Cabo+Frio" },
                    { title: "Ilha do Japon√™s", desc: "Acess√≠vel a p√© se mar√© baixa. √Ågua na canela.", maps: "https://www.google.com/maps/search/?api=1&query=Ilha+do+Japones+Cabo+Frio" }
                ]
            },
            "01/01": {
                label: "01 Qui", color: "var(--orange)", mapFocus: [-22.7780, -41.9050], zoom: 12,
                summary: "Bem-vindo a 2025! Dia de explorar B√∫zios com estilo. Acordaremos um pouco mais tarde p√≥s-festa. Foco na Praia de Gerib√° e fim de tarde na Orla Bardot.",
                checklist: "üï∂Ô∏è √ìculos escuros (ressaca), Canga, Roupa mais arrumada para o fim de tarde/noite em B√∫zios.",
                events: [
                    { time: "10:30 - 11:15", title: "Ida para B√∫zios", emoji: "üöò", type: "travel", desc: "Caminho pela Rasa/Manguinhos. Evita o tr√¢nsito do centro de Cabo Frio.", maps: "https://www.google.com/maps/search/?api=1&query=Buzios", coords: [-22.7750, -41.9100] },
                    { time: "11:30 - 16:30", title: "Praia de Gerib√°", emoji: "üåä", type: "beach", desc: "A praia mais famosa e badalada. Ondas, gente bonita e estrutura de beach clubs (Fishbone).", tips: "Estacionar √© dif√≠cil e caro. Procurem ruas laterais ou paguem o estacionamento (R$ 30-50) pela paz de esp√≠rito.", maps: "https://www.google.com/maps/search/?api=1&query=Praia+de+Geriba+Buzios", insta: "https://www.instagram.com/explore/locations/215367623/praia-de-geriba", coords: [-22.7780, -41.9050] },
                    { time: "17:00 - 19:30", title: "Rua das Pedras & Orla Bardot", emoji: "üö∂", type: "culture", desc: "Passeio cl√°ssico. Lojas de grife, est√°tua da Brigitte Bardot e sorveterias. O charme de B√∫zios est√° aqui.", tips: "Parada obrigat√≥ria no 'Chez Michou' para comer crepe.", maps: "https://www.google.com/maps/search/?api=1&query=Rua+das+Pedras+Buzios", insta: "https://www.instagram.com/chezmichou.buzios", coords: [-22.7540, -41.8880] },
                    { time: "18:00 - 19:00", title: "P√¥r do Sol: Porto da Barra", emoji: "üåÖ", type: "beach", desc: "P√≠er gastron√¥mico em Manguinhos. O visual do sol caindo nos barcos de pesca √© lindo.", maps: "https://www.google.com/maps/search/?api=1&query=Porto+da+Barra+Buzios", coords: [-22.7650, -41.9200] },
                    { time: "21:00 - 23:00", title: "Jantar: Lasanha", emoji: "üßÄ", type: "home", desc: "Recupera√ß√£o p√≥s-sol. Lasanha no forno e descanso total.", coords: homeCoords }
                ],
                extras: [
                    { title: "Praia da Ferradurinha", desc: "Ao lado de Gerib√°. Pequena e calma. Aluguel de caiaque.", maps: "https://www.google.com/maps/search/?api=1&query=Praia+da+Ferradurinha+Buzios" },
                    { title: "Gran Cine Bardot", desc: "Cinema hist√≥rico e charmoso no centro.", maps: "https://www.google.com/maps/search/?api=1&query=Gran+Cine+Bardot" }
                ]
            },
            "02/01": {
                label: "02 Sex", color: "var(--green)", mapFocus: [-22.8835, -42.0090], zoom: 13,
                summary: "Dia de despedida do mar. Vamos conhecer o cart√£o postal (Forte S√£o Mateus) e comer bem no Canal antes de encerrar a viagem.",
                checklist: "üì∏ C√¢mera carregada, Dinheiro trocado para feirinha de artesanato.",
                events: [
                    { time: "09:30 - 11:30", title: "Forte S√£o Mateus", emoji: "üè∞", type: "culture", desc: "Constru√ß√£o hist√≥rica de 1616. A melhor vista panor√¢mica da Praia do Forte.", tips: "Cuidado com as pedras se a mar√© estiver alta. Local perfeito para a foto oficial da viagem.", maps: "https://www.google.com/maps/search/?api=1&query=Forte+Sao+Mateus+Cabo+Frio", insta: "https://www.instagram.com/explore/locations/234479633/forte-sao-mateus", coords: [-22.8835, -42.0090] },
                    { time: "11:30 - 13:30", title: "Praia das Dunas", emoji: "üèúÔ∏è", type: "beach", desc: "Continua√ß√£o da Praia do Forte. Menos cheia, com dunas brancas enormes e preservadas.", tips: "√ìtimo para o √∫ltimo mergulho. √Ågua gelada e revigorante.", maps: "https://www.google.com/maps/search/?api=1&query=Praia+das+Dunas+Cabo+Frio", coords: [-22.8950, -42.0250] },
                    { time: "14:00 - 15:30", title: "Almo√ßo: Tia Maluca", emoji: "ü•ò", type: "food", desc: "Restaurante tradicional no Boulevard Canal. Famoso pelas Moquecas e pratos de peixe.", tips: "Pratos bem servidos, pre√ßo justo. Pe√ßam mesa na varanda.", maps: "https://www.google.com/maps/search/?api=1&query=Restaurante+Tia+Maluca+Cabo+Frio", insta: "https://www.instagram.com/tiamalucarestaurante", coords: [-22.8840, -42.0180] },
                    { time: "16:00 - 17:30", title: "Feirinha de Artesanato", emoji: "üíç", type: "culture", desc: "Na pra√ßa em frente ao teatro municipal. Lembrancinhas, cangas e biqu√≠nis.", maps: "https://www.google.com/maps/search/?api=1&query=Feirinha+de+Artesanato+Cabo+Frio", coords: [-22.8820, -42.0160] },
                    { time: "20:00 - 23:00", title: "Burger & Despedida", emoji: "üçî", type: "home", desc: "Hamb√∫rguer artesanal na chapa, acabar com as bebidas que sobraram e fechar a conta da viagem.", coords: homeCoords }
                ],
                extras: [
                    { title: "Museu do Surf", desc: "Maior museu de surf do Brasil. Fica na pra√ßa da feirinha.", maps: "https://www.google.com/maps/search/?api=1&query=Museu+do+Surf+Cabo+Frio" },
                    { title: "Praia do Foguete", desc: "Praia de tombo, √°guas profundas e visual selvagem.", maps: "https://www.google.com/maps/search/?api=1&query=Praia+do+Foguete+Cabo+Frio" }
                ]
            }
        };

        const recipes = [
            {
                title: "Penne R√∫stico (29/12)",
                img: "https://images.unsplash.com/photo-1608219992759-8d74ed8d76eb?w=600&q=80",
                ingredients: ["500g Penne", "600g Fil√© Mignon em tiras", "2 latas Tomate Pelati", "Manjeric√£o Fresco", "Parmes√£o Ralado"],
                steps: ["Cozinhar o Penne al dente.", "Selar a carne com azeite bem quente.", "Refogar alho, cebola e temperos na mesma panela.", "Juntar o tomate e o manjeric√£o.", "Misturar tudo e servir com parmes√£o."]
            },
            {
                title: "Strogonoff (30/12)",
                img: "https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=600&q=80",
                ingredients: ["1kg Frango em cubos", "3 cx Creme de Leite (Zero Lactose)", "Ketchup e Mostarda", "Batata Palha", "Arroz Branco"],
                steps: ["Dourar o frango.", "Adicionar cebola, ketchup e mostarda.", "Desligar o fogo.", "Misturar o creme de leite.", "Servir com arroz e batata palha."]
            },
            {
                title: "Churrasco (31/12)",
                img: "https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=600&q=80",
                ingredients: ["Picanha", "Lingui√ßa Toscana", "P√£o de Alho", "Farofa", "Vinagrete"],
                steps: ["Acender carv√£o 40min antes.", "Picanha fatiada grossa s√≥ no Sal Grosso.", "Lingui√ßa na brasa m√©dia.", "Assar p√£o de alho nas bordas."]
            },
            {
                title: "Lasanha (01/01)",
                img: "https://plus.unsplash.com/premium_photo-1664478291780-0c67f5fb15e6?w=800&q=80",
                ingredients: ["Massa de Lasanha", "500g Carne Mo√≠da (Molho)", "800g Presunto", "800g Mussarela"],
                steps: ["Fazer molho bolonhesa bem caldoso.", "Montar: Molho > Massa > Presunto > Queijo.", "Repetir at√© o topo.", "Forno 200¬∞C por 40 min."]
            },
            {
                title: "Burger (02/01)",
                img: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=600&q=80",
                ingredients: ["Fraldinha moida", "Queijo Cheddar/Prato", "P√£o de Hamb√∫rguer", "Bacon"],
                steps: ["Moldar carne em bolas de 180g.", "Grelhar em frigideira muito quente e amassar (smash).", "Sal e pimenta na hora.", "Queijo em cima e abafar."]
            }
        ];

        // Listas Est√°ticas
        const packingList = {
            "Eletr√¥nicos ‚ö°": {
                color: "var(--yellow)",
                items: [
                    { name: "Power Bank", emoji: "üîã" },
                    { name: "Fones de ouvido", emoji: "üéß" },
                    { name: "Carregador Celular", emoji: "üîå" },
                    { name: "Cabo USB/Lightning", emoji: "‚û∞" },
                    { name: "Adaptador de Tomada (T)", emoji: "‚ö°" },
                    { name: "Carregador Watch/Outros", emoji: "‚åö" },
                    { name: "Kindle/Livro", emoji: "üìñ" },
                    { name: "Caixinha de som", emoji: "üîä" }
                ]
            },
            "Higiene üõÅ": {
                color: "var(--teal)",
                items: [
                    { name: "Xampu", emoji: "üß¥" },
                    { name: "Condicionador", emoji: "üß¥" },
                    { name: "M√°scara Capilar", emoji: "üíÜ‚Äç‚ôÄÔ∏è" },
                    { name: "Creme de Pentear/Gel", emoji: "üíá‚Äç‚ôÇÔ∏è" },
                    { name: "Sabonete L√≠quido/Barra", emoji: "üßº" },
                    { name: "Hidratante Corporal", emoji: "üß¥" },
                    { name: "Escova de Dentes", emoji: "ü™•" },
                    { name: "Pasta de Dente", emoji: "ÔøΩ" },
                    { name: "Fio Dental", emoji: "ÔøΩ" },
                    { name: "Protetor Solar Corpo", emoji: "‚òÄÔ∏è" },
                    { name: "Protetor Solar Rosto", emoji: "üòé" },
                    { name: "Bronzeador", emoji: "ü••" },
                    { name: "P√≥s Sol", emoji: "üå°Ô∏è" },
                    { name: "Repelente", emoji: "ü¶ü" },
                    { name: "Protetor Labial", emoji: "üëÑ" },
                    { name: "Perfume", emoji: "üëÉ" },
                    { name: "Desodorante", emoji: "üí®" },
                    { name: "Preservativo/Lubrif.", emoji: "üçÜ" },
                    { name: "Escova de Cabelo", emoji: "ÔøΩ" },
                    { name: "Absorvente", emoji: "ü©∏" }
                ]
            },
            "Medica√ß√£o üíä": {
                color: "var(--red)",
                items: [
                    { name: "Dipirona/Paracetamol", emoji: "üíä" },
                    { name: "Dorflex/Relaxante", emoji: "üòñ" },
                    { name: "Pastilha Garganta", emoji: "ÔøΩÔ∏è" },
                    { name: "ENO/Anti√°cido", emoji: "üî•" },
                    { name: "Epocler/Engov", emoji: "ü§¢" },
                    { name: "Antial√©rgico", emoji: "ü§ß" },
                    { name: "Curativos/Bandelds", emoji: "ü©π" },
                    { name: "Anticoncepcional", emoji: "üìÖ" },
                    { name: "Rem√©dios Uso Cont√≠nuo", emoji: "üîÑ" }
                ]
            },
            "Pessoal üëú": {
                color: "var(--purple)",
                items: [
                    { name: "Celular", emoji: "üì±" },
                    { name: "Rel√≥gio/Smartwatch", emoji: "‚åö" },
                    { name: "Carteira & Dinheiro", emoji: "üí∏" },
                    { name: "Cart√µes Cr√©dito/D√©bito", emoji: "üí≥" },
                    { name: "Cart√£o Plano Sa√∫de/SUS", emoji: "üè•" },
                    { name: "CNH/RG (F√≠sico)", emoji: "ü™™" },
                    { name: "√ìculos de Grau", emoji: "ÔøΩ" },
                    { name: "√ìculos de Sol", emoji: "üï∂Ô∏è" },
                    { name: "Chaves Casa/Carro", emoji: "üîë" },
                    { name: "Documento Carro", emoji: "üìÑ" },
                    { name: "Garrafa de √Ågua", emoji: "üíß" }
                ]
            },
            "Roupa üëï": {
                color: "var(--blue)",
                items: [
                    { name: "Camisetas/Regatas", emoji: "üëï" },
                    { name: "Shorts de Praia", emoji: "ü©≥" },
                    { name: "Bermudas de Sair", emoji: "üëñ" },
                    { name: "Cal√ßa (Sair/Frio)", emoji: "üëñ" },
                    { name: "Sunga/Biquini/Mai√¥", emoji: "üëô" },
                    { name: "Roupa √çntima (Cueca/Calcinha)", emoji: "ü©≤" },
                    { name: "Pijama", emoji: "üò¥" },
                    { name: "Meias", emoji: "üß¶" },
                    { name: "Chinelo", emoji: "ü©¥" },
                    { name: "T√™nis/Cal√ßado Fechado", emoji: "üëü" },
                    { name: "Sand√°lia/Rasteirinha", emoji: "üë°" },
                    { name: "Bon√©/Chap√©u", emoji: "üß¢" },
                    { name: "Sa√≠da de Praia/Canga", emoji: "üèñÔ∏è" },
                    { name: "Bolsa/Mochila/Pochete", emoji: "üéí" }
                ]
            },
            "Outros üõå": {
                color: "var(--gray)",
                items: [
                    { name: "Len√ßol", emoji: "üõèÔ∏è" },
                    { name: "Fronha", emoji: "‚¨ú" },
                    { name: "Travesseiro", emoji: "üò¥" },
                    { name: "Coberta/Manta", emoji: "ü•∂" },
                    { name: "Touca de Cetim", emoji: "üíÜ" },
                    { name: "Toalha de Banho", emoji: "üöø" }
                ]
            }
        };

        // Itens Iniciais de Compra
        const initialShoppingItems = [
            { id: 1, name: "Creme de Leite ZERO LACTOSE (6 cx)", price: 30.0, checked: false },
            { id: 2, name: "Leite Condensado ZERO LACTOSE (4 cx)", price: 32.0, checked: false },
            { id: 3, name: "Leite ZERO LACTOSE (3 lt)", price: 18.0, checked: false },
            { id: 4, name: "Requeij√£o ZERO LACTOSE (1 pt)", price: 12.0, checked: false },
            { id: 5, name: "A√ß√∫car (1 kg)", price: 5.0, checked: false },
            { id: 6, name: "Caf√© em P√≥ (250g) (1 pct)", price: 10.0, checked: false },
            { id: 7, name: "Filtro de Caf√© 103 (1 pct)", price: 5.0, checked: false },
            { id: 8, name: "Massa de Lasanha (2 cx)", price: 16.0, checked: false },
            { id: 9, name: "Azeite de Oliva (500ml) (1 gf)", price: 35.0, checked: false },
            { id: 10, name: "Arroz Branco (2 kg)", price: 12.0, checked: false },
            { id: 11, name: "Macarr√£o Penne (500g) (1 pct)", price: 6.0, checked: false },
            { id: 12, name: "Molho Tomate Pelado (6 lat)", price: 42.0, checked: false },
            { id: 13, name: "Batata Palha (Gde) (2 pct)", price: 16.0, checked: false },
            { id: 14, name: "Farofa Pronta (1 pct)", price: 8.0, checked: false },
            { id: 15, name: "Ketchup / Mostarda / Maionese (1 un)", price: 30.0, checked: false },
            { id: 16, name: "Temperos Secos (1 kit)", price: 15.0, checked: false },
            { id: 17, name: "Sal Grosso (1kg) (1 pct)", price: 5.0, checked: false },
            { id: 18, name: "Suco Conc. Maracuj√° (1 gf)", price: 12.0, checked: false },
            { id: 19, name: "Alcatra ou Contra-fil√© (Bifes) (800 g)", price: 45.0, checked: false },
            { id: 20, name: "Picanha ou Alcatra (Pe√ßa) (1.5 kg)", price: 100.0, checked: false },
            { id: 21, name: "Lingui√ßa Toscana (1.0 kg)", price: 25.0, checked: false },
            { id: 22, name: "Coxinha da Asa (Temp.) (1.0 kg)", price: 20.0, checked: false },
            { id: 23, name: "Peito de Frango (Cubos) (1.5 kg)", price: 30.0, checked: false },
            { id: 24, name: "Carne Mo√≠da (Patinho) (2.2 kg)", price: 85.0, checked: false },
            { id: 25, name: "Bacon Fatiado (400 g)", price: 35.0, checked: false },
            { id: 26, name: "Mussarela Fatiada (800 g)", price: 45.0, checked: false },
            { id: 27, name: "Mussarela ZERO LACTOSE (200 g)", price: 18.0, checked: false },
            { id: 28, name: "Presunto Fatiado (800 g)", price: 35.0, checked: false },
            { id: 29, name: "Manteiga / Requeij√£o (1 pt)", price: 22.0, checked: false },
            { id: 30, name: "Margarina Vegetal (1 pt)", price: 8.0, checked: false },
            { id: 31, name: "Leite Integral (2 lt)", price: 10.0, checked: false },
            { id: 32, name: "Ovos Brancos (40 un)", price: 36.0, checked: false },
            { id: 33, name: "P√£o de Alho (2 pct)", price: 25.0, checked: false },
            { id: 34, name: "Cebola (1.5 kg)", price: 8.0, checked: false },
            { id: 35, name: "Alho (4 cb)", price: 5.0, checked: false },
            { id: 36, name: "Tomate (8 un)", price: 10.0, checked: false },
            { id: 37, name: "Alface Americana (2 p√©)", price: 10.0, checked: false },
            { id: 38, name: "Lim√£o Taiti (1.5 kg)", price: 10.0, checked: false },
            { id: 39, name: "Frutas (Banana/Ma√ß√£) (1 kg)", price: 20.0, checked: false },
            { id: 40, name: "P√£o de Hamb√∫rguer (2 pct)", price: 18.0, checked: false },
            { id: 41, name: "P√£o de Forma (3 pct)", price: 25.0, checked: false },
            { id: 42, name: "P√£o Franc√™s (5 un)", price: 5.0, checked: false },
            { id: 43, name: "Carv√£o (5kg) (1 sc)", price: 25.0, checked: false },
            { id: 44, name: "√Ågua de Coco (Caixa) (3 lt)", price: 30.0, checked: false },
            { id: 45, name: "Xeque Mate (12 lat)", price: 60.0, checked: false },
            { id: 46, name: "Mascate Drinques Melancia (8 lat)", price: 90.0, checked: true },
            { id: 47, name: "Ballena Morango (1 gf)", price: 0.0, checked: true },
            { id: 48, name: "Beats (Senses/GT) (6 lat)", price: 30.0, checked: false },
            { id: 49, name: "Vodka (2 gf)", price: 80.0, checked: false },
            { id: 50, name: "Sprite / Soda (2L) (3 gf)", price: 25.0, checked: false },
            { id: 51, name: "Suco Integral (1.5L) (3 gf)", price: 35.0, checked: false },
            { id: 52, name: "Refrigerante (2L) (3 gf)", price: 25.0, checked: false },
            { id: 53, name: "√Ågua Mineral (1.5L) (4 fd)", price: 60.0, checked: false },
            { id: 54, name: "Gelo Cubo (5 sc)", price: 50.0, checked: false }
        ];

        // --- L√ìGICA & FIREBASE ---
        let map;
        let markers = [];
        let polyline;
        let localShoppingList = [];

        // 1. COLE AQUI SUAS CHAVES DO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyA6Qje4rE2Qw1hB9lbvfkVlVxVPCa8W_hg",
            authDomain: "viagem-cabo-frio.firebaseapp.com",
            databaseURL: "https://viagem-cabo-frio-default-rtdb.firebaseio.com",
            projectId: "viagem-cabo-frio",
            storageBucket: "viagem-cabo-frio.firebasestorage.app",
            messagingSenderId: "305397708038",
            appId: "1:305397708038:web:db038c34373f70c6acda87",
            measurementId: "G-354QCH4RVR"
        };

        let dbRef;
        try {
            if (firebaseConfig.apiKey !== "SUA_API_KEY_AQUI") {
                firebase.initializeApp(firebaseConfig);
                dbRef = firebase.database().ref('lista_compras');
            } else {
                localShoppingList = [...initialShoppingItems];
            }
        } catch (e) {
            console.error("Erro ao conectar Firebase.", e);
            localShoppingList = [...initialShoppingItems];
        }

        function init() {
            map = L.map('map-area', { zoomControl: false }).setView(homeCoords, 13);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', { attribution: '' }).addTo(map);

            const menuContainer = document.getElementById('menu-container');
            recipes.forEach(r => {
                const ingredientsHtml = r.ingredients.map(ing => `<li>${ing}</li>`).join('');
                menuContainer.innerHTML += `
                    <div class="recipe-card">
                        <img src="${r.img}" class="recipe-img">
                        <div class="recipe-content">
                            <h3 style="margin:0 0 10px 0">${r.title}</h3>
                            <div style="background:#f9f9f9; padding:10px; border-radius:8px; margin-bottom:15px; font-size:0.85rem;">
                                <div style="font-weight:700; margin-bottom:5px; color:#555">Ingredientes:</div>
                                <ul style="margin:0; padding-left:20px;">${ingredientsHtml}</ul>
                            </div>
                            ${r.steps.map((s, i) => `<div class="step"><div class="step-num">${i + 1}</div><div style="font-size:0.9rem; line-height:1.4">${s}</div></div>`).join('')}
                        </div>
                    </div>`;
            });

            const packContainer = document.getElementById('packing-list-container');
            for (const [category, data] of Object.entries(packingList)) {
                let html = `<div style="background: ${data.color || '#eee'}; color: white; padding: 8px 12px; border-radius: 8px; margin: 25px 0 10px 0; font-weight: 700; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.5px;">${category}</div>`;
                data.items.forEach(item => {
                    html += `
                    <div style="padding:10px 0; border-bottom:1px solid #eee; display:flex; align-items:center;">
                        <span style="font-size:1.2rem; margin-right:12px;">${item.emoji}</span> 
                        <span style="font-size:0.95rem;">${item.name}</span>
                    </div>`;
                });
                packContainer.innerHTML += html;
            }

            renderDays();
            setupShoppingList();
        }

        function toggleMap() {
            const mapArea = document.getElementById('map-area');
            const btnText = document.getElementById('map-toggle-text');

            if (mapArea.classList.contains('collapsed')) {
                mapArea.classList.remove('collapsed');
                btnText.innerText = "Ocultar";
                setTimeout(() => map.invalidateSize(), 300);
            } else {
                mapArea.classList.add('collapsed');
                btnText.innerText = "Mapa";
            }
        }

        function renderDays() {
            const container = document.getElementById('days-container');
            const dates = Object.keys(db);
            container.innerHTML = '';
            dates.forEach((date, i) => {
                const btn = document.createElement('div');
                btn.className = `day-btn ${i === 0 ? 'active' : ''}`;
                btn.innerText = db[date].label;
                btn.onclick = () => loadDay(date, btn);
                container.appendChild(btn);
            });
            loadDay(dates[0]);
        }

        function loadDay(date, btn) {
            if (btn) { document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
            const data = db[date];
            const content = document.getElementById('day-content');

            if (polyline) map.removeLayer(polyline);
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            const routePoints = [];

            let html = `
                <div class="summary-card">
                    <div style="font-size:0.8rem; font-weight:700; color:#888; margin-bottom:5px;">VIBE DO DIA</div>
                    <div style="font-size:0.95rem; line-height:1.5; color:#333;">${data.summary}</div>
                    <div class="checklist"><h4 style="margin:0 0 5px 0; font-size:0.8rem; color:var(--blue);">üéí N√ÉO ESQUECER</h4><p style="margin:0; font-size:0.9rem;">${data.checklist}</p></div>
                </div>`;

            data.events.forEach(ev => {
                const typeColors = { 'travel': 'var(--blue)', 'food': 'var(--orange)', 'beach': 'var(--teal)', 'home': 'var(--green)', 'culture': 'var(--purple)' };
                const borderColor = typeColors[ev.type];

                let btns = '';
                if (ev.maps) btns += `<a href="${ev.maps}" target="_blank" class="btn btn-map">üó∫Ô∏è Maps</a>`;
                if (ev.insta) btns += `<a href="${ev.insta}" target="_blank" class="btn btn-insta">üì∏ Insta</a>`;

                html += `
                    <div class="event-card" style="border-left-color: ${borderColor}">
                        <div class="event-header">
                            <div class="event-emoji">${ev.emoji}</div>
                            <div style="flex:1">
                                <div class="event-time-badge">${ev.time}</div>
                                <h3 class="event-title">${ev.title}</h3>
                            </div>
                        </div>
                        <div class="event-desc">${ev.desc}</div>
                        ${ev.tips ? `<div class="tips-box">üí° <b>Dica:</b> ${ev.tips}</div>` : ''}
                        <div class="buttons-row">${btns}</div>
                    </div>`;

                if (ev.coords) {
                    if (routePoints.length === 0 && ev.type !== 'travel' && !ev.title.includes("Sa√≠da")) routePoints.push(homeCoords);
                    routePoints.push(ev.coords);
                    const m = L.marker(ev.coords, { icon: L.divIcon({ className: '', html: `<div style="background:${borderColor}; width:16px; height:16px; border-radius:50%; border:2px solid white; box-shadow:0 2px 5px rgba(0,0,0,0.3)"></div>` }) }).addTo(map).bindPopup(ev.title);
                    markers.push(m);
                }
            });

            if (data.extras) {
                html += `<div class="extras-section"><div class="extras-title">‚ú® Op√ß√µes Extras</div>`;
                data.extras.forEach(ex => {
                    html += `
                        <div class="extra-card">
                            <div style="flex:1">
                                <div style="font-weight:700">${ex.title}</div>
                                <div style="font-size:0.85rem; color:#666">${ex.desc}</div>
                                <div style="margin-top:5px"><a href="${ex.maps}" target="_blank" class="btn btn-map" style="font-size:0.75rem; padding:4px 8px">üó∫Ô∏è Ver Local</a></div>
                            </div>
                        </div>`;
                });
                html += `</div>`;
            }

            content.innerHTML = html;
            content.scrollTop = 0;

            if (routePoints.length > 1) {
                polyline = L.polyline(routePoints, { color: data.color, weight: 4, opacity: 0.7, dashArray: '5, 10' }).addTo(map);
                map.fitBounds(polyline.getBounds(), { padding: [50, 50] });
            } else {
                map.setView(data.mapFocus || homeCoords, data.zoom);
            }
        }

        // --- L√ìGICA DE COMPRAS ATUALIZADA ---

        // Fun√ß√£o auxiliar para salvar (Firebase ou Local) e atualizar tela
        function syncData() {
            if (dbRef) dbRef.set(localShoppingList);
            renderShoppingList();
        }

        function setupShoppingList() {
            if (dbRef) {
                dbRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) localShoppingList = data;
                    else {
                        // Se vazio, inicia com a lista padr√£o
                        localShoppingList = [...initialShoppingItems];
                        dbRef.set(localShoppingList);
                    }
                    renderShoppingList();
                });
            } else {
                renderShoppingList();
            }
        }

        function renderShoppingList() {
            const container = document.getElementById('shopping-list-container');
            container.innerHTML = '';
            let total = 0;

            // Garante que a lista existe
            if (!localShoppingList) localShoppingList = [];

            localShoppingList.forEach((item, index) => {
                const price = parseFloat(item.price || 0);
                total += price;

                const div = document.createElement('div');
                div.className = `shop-item ${item.checked ? 'checked' : ''}`;

                // HTML com campos edit√°veis e bot√£o de deletar
                div.innerHTML = `
                    <div class="shop-check" onclick="toggleCheck(${index})">${item.checked ? '‚úî' : ''}</div>
                    
                    <input type="text" class="shop-name-input" value="${item.name}" onchange="updateName(${index}, this.value)">
                    
                    <div class="shop-price-container">
                        <span class="shop-currency">R$</span>
                        <input type="text" inputmode="decimal" class="shop-price-input" 
                            value="${price.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}" 
                            onchange="updatePrice(${index}, this.value)"
                            onfocus="this.select()"
                        >
                    </div>
                    
                    <button class="delete-btn" onclick="deleteItem(${index})">‚úï</button>
                `;
                container.appendChild(div);
            });

            // Atualiza os totais no topo
            document.getElementById('total-price').innerText = total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            const split = total / 6; // Divis√£o por 6 pessoas
            document.getElementById('split-price').innerText = split.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
        }

        // --- NOVAS FUN√á√ïES DE A√á√ÉO ---

        function addNewItem() {
            const input = document.getElementById('new-item-input');
            const text = input.value.trim();

            if (text) {
                // Adiciona ao in√≠cio da lista
                localShoppingList.unshift({
                    id: Date.now(), // ID √∫nico
                    name: text,
                    price: 0,
                    checked: false
                });
                input.value = ''; // Limpa o campo
                syncData(); // Salva e atualiza
            }
        }

        function deleteItem(index) {
            // Remove o item da lista
            if (confirm('Tem certeza que quer remover este item?')) {
                localShoppingList.splice(index, 1);
                syncData();
            }
        }

        function updateName(index, newName) {
            localShoppingList[index].name = newName;
            syncData(); // Salva sem recarregar tudo bruscamente, mas garante persist√™ncia
        }

        function toggleCheck(index) {
            localShoppingList[index].checked = !localShoppingList[index].checked;
            syncData();
        }

        function updatePrice(index, value) {
            // Converte "1.000,50" -> 1000.50
            let cleanValue = value.replace(/[^\d,]/g, '').replace(',', '.');
            localShoppingList[index].price = parseFloat(cleanValue) || 0;
            syncData();
        }

        // --- NAVEGA√á√ÉO ---
        function switchTab(tab) {
            document.querySelectorAll('.dock-item').forEach(i => i.classList.remove('active'));
            event.currentTarget.classList.add('active');

            const tabs = ['timeline', 'people', 'summary', 'menu', 'shopping', 'packing'];
            tabs.forEach(t => {
                const el = document.getElementById('view-' + t);
                if (t === tab) el.classList.remove('hidden');
                else el.classList.add('hidden');
            });

            if (tab === 'timeline') setTimeout(() => map.invalidateSize(), 100);
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>